<? require(ViewDir.'/header.html'); ?>

<link rel="stylesheet" href="<?=StaticDir?>style/mj-strademark.css"/>
<script type="text/javascript" src="<?=StaticDir?>script/objurl.js"></script>
<script type="text/javascript" src="<?=StaticDir?>script/jquery.corner.js"></script>
<script type="text/javascript" src="<?=StaticDir?>script/jquery.roundabout.js"></script>
<script type="text/javascript" src="<?=StaticDir?>script/jquery.roundabout-shapes.js"></script>


<!--content start-->
<div id="gla">
    <div id="gla_box">
        <span class="prev"></span>
        <span class="next"></span>
        <ul>
            <li>
                <div class="gla_inbox">
                    <a href=""><img src="<?=StaticDir?>style/img/mj-banner4.jpg" /></a>
                    <div class="mj-tjtip jShow">
                        <p class="mj-bimgbg"><strong>30</strong>% 折扣</p>
                        <p class="f-clearfix mj-bgimt"><span><em>50万</em><br/>现价</span><b>2.5</b>万</p>
                    </div>
                    <p class="mj-ad">
                        这里是广告语，这里就是广告口号什么的，只有一排，不会有第二排列...
                    </p>
                    <label class="mj-bgimgbg2 jShow"></label>
                </div>
            </li>
            <li>
                <div class="gla_inbox">
                    <a href=""><img src="<?=StaticDir?>style/img/mj-banner5.jpg" /></a>
                    <!--<span class="mj-specialTip mj-sl jShow" style="visibility: hidden;">昨日特价</span>-->
                    <div class="mj-tjtip jShow" style="visibility: hidden;">
                        <p class="mj-bimgbg"><strong>30</strong>% 折扣</p>
                        <p class="f-clearfix mj-bgimt"><span><em>50万</em><br/>现价</span><b>2.5</b>万</p>
                    </div>
                    <p class="mj-ad">
                        这里是广告语，这里就是广告口号什么的，只有一排，不会有第二排列...
                    </p>
                </div>
            </li>
            <li>
                <div class="gla_inbox">
                    <a href=""><img src="<?=StaticDir?>style/img/mj-banner6.jpg" /></a>
                   <!-- <span class="mj-specialTip mj-sr jShow" style="visibility: hidden;">眀日特价</span>-->
                    <div class="mj-tjtip jShow" style="visibility: hidden;">
                        <p class="mj-bimgbg"><strong>30</strong>% 折扣</p>
                        <p class="f-clearfix mj-bgimt"><span><em>50万</em><br/>现价</span><b>2.5</b>万</p>
                    </div>
                    <p class="mj-ad">
                        这里是广告语，这里就是广告口号什么的，只有一排，不会有第二排列...
                    </p>
                </div>
            </li>

        </ul>
    </div>
</div>

<div class="mj-content">
    <div class="w1180">
        <!--search start-->
        <dl class="mj-selection">
            <dd class="f-clearfix">
                <span class="mj-selection-span">商标类别：</span>
                <div class="mj-selection-list" id="j-dltype">
                    <a href="javascript:getClass(0);"  <?if ($c == 0){echo 'class="current"';}?>>全部  </a>
                <? foreach ($CLASSES as $key => $value) { ?>
                    <a href="javascript:getClass(<?=$key?>);" <?if ($c == $key){echo 'class="current"';}?>><?echo $key.'类-'.$value?></a>
                <? } ?>
                    <a href="javascript:;" class="curs" id="mj_aclik">......</a>
                </div>
            </dd>
        <? if( !empty($groupList) ){ ?>
            <dd class="f-clearfix">
                <span class="mj-selection-span">所属群组：</span>
                <div class="mj-selection-list" id="g-dltype">
                    <a href="javascript:getGroup(0);" <?if ($g == 0){echo 'class="current"';}?>>全部  </a>
                <? foreach ($groupList as $ky => $val) { ?>
                    <a href="javascript:getGroup('<?=$ky?>');" <?if ($g == $ky){echo 'class="current"';}?> title="<?=$val?>">
                    <?=mb_substr($val, 0, 6, 'utf8')?></a>
                <? } ?>
                <? if ( count($groupList) > 10 ){?>
                    <a href="javascript:;" class="curs" id="mg_aclik">......</a>
                <?}?>
                </div>
            </dd>
        <? } ?>
            <dd class="f-clearfix">
                <span class="mj-selection-span">平台入驻： </span>
                <div class="mj-selection-list">
                    <a href="javascript:getPlatform(0);" <?if ($p == 0){echo 'class="current"';}?>>全部  </a>
                <? foreach ($PLATFORM as $k => $v) { ?>
                    <a href="javascript:getPlatform(<?=$k?>);" <?if ($p == $k){echo 'class="current"';}?>><?=$v?></a>
                <? } ?>
                </div>
            </dd>
        </dl>
    </div>
        <!--search end-->
        <!--imglist start-->
    <div class="mj_goods_check">
        <div class="w1180">
            <ul class="f-clearfix mj-pu">
                <li>
                    <!--<label class="mj-mt26">商标类别：</label>-->
                    <div class="select_boxs">
                        <span id="sType" tid="<?=$t?>" class="mj-textS">
                        <?if ( empty($t) ){echo '商标类别';}else{echo $TYPES[$t];}?>
                        </span>
                        <ul class="son_ul" style="display: none;">
                            <li tid="0">全部</li>
                            <? foreach ($TYPES as $k => $v) { ?>
                            <li tid="<?=$k?>"><?=$v?></li>
                            <? } ?>
                        </ul>
                    </div>
                </li>
                <li>
                    <!--<label class="mj-mt26">商标字数：</label>-->
                    <div class="select_boxs select_boxW">
                        <span id="sNumber" tid="<?=$sn?>" class="mj-textS">
                        <?if ( empty($sn) ){echo '商标字数';}else{echo $NUMBER[$sn];}?>
                        </span>
                        <ul class="son_ul son_uls" style="display: none;">
                            <li tid="0">全部</li>
                            <? foreach ($NUMBER as $k => $v) { ?>
                            <li tid="<?=$k?>"><?=$v?></li>
                            <? } ?>
                        </ul>
                    </div>
                </li>
                <li class="mj-determine"><a href="javascript:;" id="sSubmit">确认</a></li>
            </ul>
        </div>
    </div>
        <div class="w1180">
            <div class="mj-imglists">
                <ul class="f-clearfix" id="s-all-list">
                <? foreach ($searchList as $k => $v) { ?>
                    <li>
                        <p class="mj-tip">
                            <?if ($v['isOffprice'] == true){?><label class="mj-tThe" title="特价产品">特</label><?}?>
                            <?if ($v['isBest'] == true){?><label class="mj-tJing" title="精品推荐">精</label><?}?>
                            <?if ($v['isLicence'] == true){?><label class="mj-tShow" title="授权租用">授</label><?}?>
                            <?if ($v['isApprove'] == true){?><label class="mj-tZheng" title="认证通过">认</label><?};?>
                        </p>
                        <div class="mj-imglT">
                            <a href="/trademark/view/?tid=<?=$v['tid']?>&class=<?=$v['class']?>" target="_blank" class="mj-imglT"><span><img src="<?=$v['imgUrl']?>" onerror="this.src='<?=StaticDir?>images/img1.png'" title="<?=$v['name']?>"></span></a>
                        </div>
                        <div class="mj-imglB">
                            <p title="<?=$v['name']?>"><?=mb_substr($v['name'],0,10,'utf8')?>&nbsp;&nbsp;<?=$CLASSES[$v['class']]?></p>
                             <span class="mj-imgspan"><a href=""><strong>
                             <? if ($v['guideprice'] <= $v['salePrice']){echo '10';}else{$zk = (($v['salePrice'])/($v['guideprice']))*10;echo number_format($zk,1);}?>
                             </strong>折</a> <b><em>￥</em><em><?=$v['salePrice']?></em></b></span>
                        </div>
                    </li>
                <? } ?>
                </ul>
            </div>
            <? if (empty($searchList) || $has == false){?>
                <div id="s-nothing" style="padding-top:33px;text-align:center;"><img src="<?=StaticDir?>images/nogoods.png"></div>
            <?}?>
            <div id="s-nothing" style="padding-top:33px;text-align:center;display:none;"><img src="<?=StaticDir?>images/last.png"></div>
            <div id="s-uploading" style="padding-top:33px;text-align:center;display:none;height:100px;"><img src="<?=StaticDir?>images/loading.gif"></div>
        </div>
        <!--imglist end-->
</div>

<!--content end-->
<div class="mj-mainbg">
    <div class="mj-maclose">
    </div>
    <div class="mj-footerTip">
        <div class="w1180">
            <div class="mj-bgimg">
                <img src="<?=StaticDir?>style/img/mj-img7.png" alt=""/>
                <a href=""><span>后面还有 <strong> 3000 </strong>商标可购买，实在太多 --  提交购买需求我们帮你匹配？</span></a>
                <label id="mj-label"></label>
            </div>
        </div>
    </div>
</div>

<div id="_tmpDiv" style="display:none"></div>

<script type="text/javascript">
    var _number     = <?=$_number?>;
    var _start      = 0;
    var _whereStr   = "<?=$whereStr?>";
    var _moreUrl    = '/offprice/getMore/';
    var _url        = '/offprice/index/?';
    var _has        = "<?=$has?>";
    var _class      = "<?=$c?>";
    var _group      = "<?=$g?>";

    function getClass(cls)
    {
        var obj = new objURL('/?'+_whereStr);
        obj.set('c', cls==0?'':cls);
        obj.set('g', '');
        obj.set('p', '');
        obj.set('t', '');
        obj.set('sn', '');
        var params = obj.strparams();
        window.location = _url+params;
    }

    function getGroup(grp)
    {
        var obj = new objURL('/?'+_whereStr);
        obj.set('c', _class==0?'':_class);
        obj.set('g', grp==0?'':grp);
        obj.set('p', '');
        var params = obj.strparams();
        window.location = _url+params;
    }

    function getPlatform(plat)
    {
        var obj = new objURL('/?'+_whereStr);
        obj.set('c', _class==0?'':_class);
        obj.set('g', _group==0?'':_group);
        obj.set('p', plat==0?'':plat);
        var params = obj.strparams();
        window.location = _url+params;
    }

    function loadMore(){
        if (!_has) return false;
        $('#s-uploading').show();
        var obj = new objURL('/?'+_whereStr);
        _start += _number;
        obj.set('n', _start);
        var params = obj.getparams();
        $("#_tmpDiv").load(_moreUrl, params, function(data,status,xml){
            if (status != 'success'){
                $('#s-uploading').hide();
                $("#s-nothing").html('请求失败，请稍后再试。');
                $("#s-nothing").show();
                return false;
            }
            if (data) {
                $("#s-all-list").append(data);
                $("#_tmpDiv").html('');
                $('#s-uploading').hide();
            }else{
                _has = false;
                $('#s-uploading').hide();
                $("#s-nothing").show();
            }
        });
    }


    if ( _class >= 10 ){
        var _first = $("#j-dltype").find('a').first();
        $("#j-dltype").prepend($("#j-dltype > .current"));
        $("#j-dltype").prepend(_first);
    }
    
    $("#g-dltype").find('a').each(function (k,v){
        if ( $(this).hasClass('current') ){
            if ( k >= 11 && $("#g-dltype").find('a').length > 8){
                var _first = $("#g-dltype").find('a').first();
                $("#g-dltype").prepend($("#g-dltype > .current"));
                $("#g-dltype").prepend(_first);
            }
        }
    });

    $("#sSubmit").click(function (){
        var _sT = $("#sType").attr('tid');
        var _sN = $("#sNumber").attr('tid');
        var obj = new objURL('/?'+_whereStr);
        obj.set('t', _sT==0?'':_sT);
        obj.set('sn', _sN==0?'':_sN);
        var params = obj.strparams();
        window.location = _url+params;
    });

    /*select*/
    $('.son_ul').hide(); //初始ul隐藏
    $('.select_boxs span').hover(function(){ //鼠标移动函数
                $(this).parent().find('ul.son_ul').slideDown();  //找到ul.son_ul显示
                $(this).parent().find('li').hover(function(){$(this).addClass('hover')},function(){$(this).removeClass('hover')}); //li的hover效果
                $(this).parent().hover(function(){},
                        function(){
                            $(this).parent().find("ul.son_ul").slideUp();
                        }
                );
            },function(){}
    );
    $('ul.son_ul li').click(function(){
        $(this).parents('li').find('.mj-textS').html($(this).html());
        $(this).parents('li').find('.mj-textS').attr('tid', $(this).attr('tid'));
        $(this).parents('li').find('ul').slideUp();
    });
    
    //悬浮层
     _nav = $('.mj_goods_check');
    $(window).scroll(function(){
        console.log($(window).scrollTop());
        if($(window).scrollTop()>=450){
            _nav.addClass("mj-navT")
        }else if($(window).scrollTop()<=450){
            _nav.removeClass("mj-navT")
        }
    });

    //banner切换
    var _prveDom = null;
    var c = $('#gla_box>ul').roundabout({
        minOpacity:0.5,
        btnNext: ".next",
        duration: 1000,
        reflect: true,
        btnPrev: '.prev',
        autoplay:true,
        autoplayDuration:3000,
        autoplayPauseOnHover: true,
        tilt:0,
        bearing:0,
        shape: 'figure7',
        autoplayCallback: function(obj){
            var _cur = this.find('.roundabout-in-focus');
            var _li = this.find('li');
            var _index = _cur.index();
            var _css = { 'visibility' : 'visible' };
            var _css1 = { 'visibility' : 'hidden' };

            //_cur.find('.jShow').css(_css);
            _li.find('.jShow').css(_css1).end().eq(_index).find('.jShow').css(_css);
        }
    });
    var foor=$(".mj-footer").height();
    $(window).scroll(function () {
        var scrollTop = $(this).scrollTop();
        var scrollHeight = $(document).height()-foor;
        var windowHeight = $(this).height();
        if (scrollHeight - scrollTop - windowHeight < 500)  {
            loadMore();
        }
    });
//(function (){
    var _ddNum = 10;
    var _jDltype = $("#j-dltype");
    var _jDltypeNum = _jDltype.find('a');
    var obj = _jDltypeNum.slice(_ddNum, _jDltypeNum.length - 1);
    obj.css({'display':'none'});
    $("#mj_aclik").click(function(){
        var _hasClass = $(this).hasClass('curs');
        var _text = '收拢';
        if( _hasClass ){
            obj.removeAttr('style');
            $(this).removeClass('curs');
            $(this).css("color","#4ba5de");
        }else{
            _text = '......';
            obj.css({'display':'none'});
            $(this).addClass('curs');
            $(this).css("color","#666");
        }
        this.text = _text;
    });

    var _gDltype = $("#g-dltype");
    var _gDltypeNum = _gDltype.find('a');
    var gobj = _gDltypeNum.slice(_ddNum, _gDltypeNum.length - 1);
    gobj.css({'display':'none'});
    $("#mg_aclik").click(function(){
        var _hasClass = $(this).hasClass('curs');
        var _text = '收拢';
        if( _hasClass ){
            gobj.removeAttr('style');
            $(this).removeClass('curs');
        }else{
            _text = '......';
            gobj.css({'display':'none'});
            $(this).addClass('curs');
        }
        this.text = _text;
    });
//});
</script>

<? require(ViewDir.'/footer.html'); ?>